<!DOCTYPE html>    
<html lang="es">    
<head>    
  <meta charset="UTF-8">    
  <meta name="viewport" content="width=device-width, initial-scale=1.0">    
  <title>Pel√≠culas Online</title>    
  <script type="module">    
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";    
    import { getDatabase, ref, onValue, push } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";    

    const firebaseConfig = {    
      apiKey: "AIzaSyCj0DVSi2LKWVEIb0vVBNmBk5kwNKwwJrg",    
      authDomain: "storeacounts-d0ca8.firebaseapp.com",    
      databaseURL: "https://storeacounts-d0ca8-default-rtdb.firebaseio.com",    
      projectId: "storeacounts-d0ca8",    
      storageBucket: "storeacounts-d0ca8.firebasestorage.app",    
      messagingSenderId: "822442149761",    
      appId: "1:822442149761:web:bb1d97c5c5f170ddb10a80"    
    };    

    const app = initializeApp(firebaseConfig);    
    const db = getDatabase(app);    
    const publicacionesRef = ref(db, "publicaciones");    

    const contenedor = document.getElementById("contenedor");    

    onValue(publicacionesRef, (snapshot) => {    
      contenedor.innerHTML = "";    
      snapshot.forEach((childSnapshot) => {    
        const data = childSnapshot.val();    
        const box = document.createElement("div");    
        box.classList.add("box");    
        box.innerHTML = `    
          <img src="${data.imagen}" alt="${data.titulo}">    
          <h2>${data.titulo}</h2>    
        `;    
        box.querySelector("img").addEventListener("click", () => mostrarDetalle(data));    
        contenedor.appendChild(box);    
      });    
    });    

    // üîπ Mostrar detalle y ocultar otros elementos
    function mostrarDetalle(data) {    
      const detalle = document.getElementById("detalle");
      detalle.innerHTML = `    
        <img src="${data.imagen}" alt="${data.titulo}">    
        <h2>${data.titulo}</h2>    
        <p>${data.descripcion}</p>    
        <a href="${data.trailer}" target="_blank" class="btn">üé¨ Ver Trailer</a>    
        <a href="${data.verOnline}" target="_blank" class="btn">‚ñ∂Ô∏è Ver Online</a>    
        <a href="#" class="btn" onclick="descargarCon1DM('${data.descargar}')">‚¨áÔ∏è Descargar</a>    
        <button id="cerrarDetalle" class="btn" style="background:#ff009d;color:white;">Cerrar</button>    
      `;    

      detalle.style.display = "flex";    
      detalle.style.flexDirection = "column";    

      // Ocultar otros elementos
      document.getElementById("contenedor").style.display = "none";    
      document.getElementById("donarBtn").style.display = "none";    
      document.getElementById("menuBtn").style.display = "none";    
      document.getElementById("visitas").style.display = "none";

      // Bot√≥n cerrar detalle
      document.getElementById("cerrarDetalle").onclick = () => {    
        detalle.style.display = "none";    
        document.getElementById("contenedor").style.display = "grid";    
        document.getElementById("donarBtn").style.display = "block";    
        document.getElementById("menuBtn").style.display = "block";    
        document.getElementById("visitas").style.display = "block";
      };    
    }    

    // üîπ Descargar con 1DM o navegador
    window.descargarCon1DM = function (urlDescarga) {    
      if (!urlDescarga) return alert("Enlace no disponible.");
      if (/Android/i.test(navigator.userAgent)) {    
        const intentUrl = `intent://${urlDescarga.replace('https://','')}#Intent;package=idm.internet.download.manager;scheme=https;end`;    
        window.location.href = intentUrl;    
        setTimeout(() => { window.open(urlDescarga, '_blank'); }, 1000);    
      } else {    
        window.open(urlDescarga, '_blank');    
      }    
    };    

    // üîπ Enviar sugerencia
    window.enviarSugerencia = function () {
      const categoria = document.getElementById("categoriaSug").value.trim();
      const nombre = document.getElementById("nombreSug").value.trim();
      if (!categoria || !nombre) {
        alert("Por favor completa todos los campos.");
        return;
      }
      const sugerenciasRef = ref(db, "sugerencias");
      push(sugerenciasRef, { categoria, nombre, fecha: new Date().toISOString() });
      alert("‚úÖ Sugerencia enviada con √©xito");
      document.getElementById("formSugerencia").reset();
      cerrarSugerir();
    }

    // üîπ Abrir / cerrar sugerencias y donaciones
    window.abrirSugerir = () => { document.getElementById("pantallaSugerir").style.display = "flex"; };
    window.cerrarSugerir = () => { document.getElementById("pantallaSugerir").style.display = "none"; };

    window.abrirDonaciones = () => { document.getElementById("pantallaDonar").style.display = "flex"; };
    window.cerrarDonar = () => { document.getElementById("pantallaDonar").style.display = "none"; };

    window.donarNequi = () => {    
      const numero = "3214701288";    
      navigator.clipboard.writeText(numero);    
      alert("N√∫mero Nequi copiado: " + numero);    
      window.location.href = "nequi://";    
      setTimeout(() => {    
        window.location.href = "https://play.google.com/store/apps/details?id=com.nequi.Colombia.nequiapp";    
      }, 2000);    
    };    

    // ---- FIX cerrar sugerir ----
    // Aseguramos que el bot√≥n "Cerrar" de la pantalla de sugerir siempre responda:
    document.addEventListener('DOMContentLoaded', () => {
      const btnCerrarSugerir = document.getElementById('cerrarSugerir');
      if (btnCerrarSugerir) {
        // listener redundante por si el `onclick` del HTML falla en alg√∫n navegador
        btnCerrarSugerir.addEventListener('click', (e) => {
          e.preventDefault();
          e.stopPropagation();
          window.cerrarSugerir();
        });
      }

      // soporte extra: cerrar modales con tecla Escape
      document.addEventListener('keydown', (ev) => {
        if (ev.key === 'Escape') {
          const pant = document.getElementById('pantallaSugerir');
          if (pant && pant.style.display === 'flex') window.cerrarSugerir();
          const pantDon = document.getElementById('pantallaDonar');
          if (pantDon && pantDon.style.display === 'flex') window.cerrarDonar();
        }
      });
    });
    // ---- FIN FIX ----

    // üîπ Contador de visitantes reales
    const visitasRef = ref(db, "visitas");
    const userId = localStorage.getItem("visitorId") || crypto.randomUUID();
    localStorage.setItem("visitorId", userId);
    push(visitasRef, { id: userId, fecha: new Date().toISOString(), userAgent: navigator.userAgent });

    const visitasDiv = document.getElementById("visitas");
    onValue(visitasRef, (snapshot) => {
      const visitantes = [];
      snapshot.forEach(child => visitantes.push(child.val()));
      visitasDiv.innerHTML = `üë• Visitantes: <b>${visitantes.length}</b>`;
    });
  </script>    

  <style>    
    body {    
      font-family: Arial, sans-serif;    
      background: #0f0f0f;    
      color: #fff;    
      text-align: center;    
      margin: 0;    
    }    
    h1 { color: #00ff9d; margin: 20px; }    

    #menuBtn {
      position: fixed; top: 15px; right: 15px;
      background: #00ff9d; color: #000;
      border: none; font-size: 24px;
      padding: 10px 15px; border-radius: 10px;
      cursor: pointer; z-index: 30;
    }

    #visitas {
      position: fixed; top: 15px; left: 15px;
      background: #1a1a1a; padding: 8px 15px;
      border-radius: 8px; box-shadow: 0 0 8px #00ff9d55;
      font-size: 16px; z-index: 25;
    }

    #contenedor {
      display: grid; grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 20px; padding: 20px; justify-items: center;
    }

    .box {
      background: #1a1a1a; padding: 15px; border-radius: 12px;
      width: 90%; max-width: 420px;
      box-shadow: 0 0 10px #00ff9d33;
      transition: transform 0.2s;
    }
    .box:hover { transform: scale(1.02); }
    .box img { width: 100%; border-radius: 10px; cursor: pointer; }
    .box h2 { font-size: 18px; margin: 10px 0; }

    #detalle, #pantallaDonar, #pantallaSugerir {
      display: none; position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.95);
      justify-content: center; align-items: center;
      flex-direction: column; z-index: 20;
    }

    #detalle img { width: 250px; border-radius: 10px; }
    #detalle h2 { color: #00ff9d; }
    #detalle p { margin: 15px auto; width: 80%; }
    .btn {
      display: inline-block; margin: 8px; padding: 10px 20px;
      background: #00ff9d; color: #000;
      border-radius: 8px; text-decoration: none;
      font-weight: bold; cursor: pointer;
    }

    #donarBtn {
      position: fixed; bottom: 20px; right: 20px;
      background: #ff0000; color: white;
      padding: 15px 25px; border-radius: 30px;
      border: none; font-size: 18px; cursor: pointer;
      box-shadow: 0 0 10px #ff0000; z-index: 5;
    }

    .donar-btn { background: #00ff9d; color: #000;
      padding: 12px 25px; border-radius: 10px;
      margin: 10px; font-size: 18px; cursor: pointer;
      border: none; font-weight: bold;
    }
    .donar-btn.paypal { background: #0070ba; color: #fff; }
    #cerrarDonar, #cerrarSugerir {
      margin-top: 20px; background: #ff009d;
      color: white; border: none; padding: 10px 20px;
      border-radius: 10px; cursor: pointer;
    }

    #formSugerencia {
      background: #1a1a1a; padding: 20px;
      border-radius: 12px; box-shadow: 0 0 10px #00ff9d55;
      width: 90%; max-width: 400px;
    }
    #formSugerencia input, #formSugerencia select {
      width: 90%; padding: 10px; margin: 10px 0;
      border: none; border-radius: 8px; font-size: 16px;
    }
    #enviarSug {
      background: #00ff9d; color: #000;
      font-weight: bold; border: none;
      padding: 10px 20px; border-radius: 8px;
      cursor: pointer;
    }
  </style>    
</head>    
<body>    
  <div id="visitas">üë• Visitantes: <b>0</b></div>
  <button id="menuBtn" onclick="abrirSugerir()">‚ò∞</button>    
  <h1>üé¨ ùêó!ùêì-ùêïùêàùêñ</h1>    
  <div id="contenedor"></div>    
  <div id="detalle"></div>    

  <button id="donarBtn" onclick="abrirDonaciones()">üíñ Donar</button>    

  <div id="pantallaDonar">    
    <h2>Apoya el proyecto</h2>    
    <button class="donar-btn" onclick="donarNequi()">Donar con Nequi üíú</button>    
    <form action="https://www.paypal.com/donate" method="post" target="_blank">    
      <input type="hidden" name="business" value="sevastiancastro92@gmail.com" />    
      <input type="hidden" name="currency_code" value="USD" />    
      <input type="submit" value="Donar con PayPal üí∏" class="donar-btn paypal">    
    </form>    
    <button id="cerrarDonar" onclick="cerrarDonar()">Cerrar</button>    
  </div>    

  <div id="pantallaSugerir">    
    <h2>üé• Sugerir pel√≠cula o serie</h2>    
    <form id="formSugerencia" onsubmit="event.preventDefault(); enviarSugerencia();">    
      <select id="categoriaSug" required>    
        <option value="">Selecciona categor√≠a</option>    
        <option value="Pel√≠cula">Pel√≠cula</option>    
        <option value="Serie">Serie</option>    
      </select>    
      <input type="text" id="nombreSug" placeholder="Nombre de la pel√≠cula o serie" required>    
      <button id="enviarSug" type="submit">Enviar sugerencia</button>    
      <button id="cerrarSugerir" type="button" onclick="cerrarSugerir()">Cerrar</button>    
    </form>    
  </div>    
</body>    
</html>
